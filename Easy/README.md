This part is the easy algorithm.
